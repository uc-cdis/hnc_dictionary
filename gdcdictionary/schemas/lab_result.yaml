$schema: "http://json-schema.org/draft-04/schema#"

id: "lab_result"
title: Laboratory Results
type: object
namespace: https://imaging-hub.data-commons.org
category: clinical
program: '*'
project: '*'
description: >
  Measurements obtained from blood or other laboratory tests required by a medical professional. These will include lipids and lipid metabolism parameters, lipid oxidation markers, cytokines, adhesion molecules, nitric oxide, and hemostasis/fibrinolysis markers.
additionalProperties: false
submittable: true
validators: null

systemProperties:
  - id
  - project_id
  - state
  - created_datetime
  - updated_datetime

links:
  - name: subject
    backref: lab_result
    label: describes
    target_type: subject
    multiplicity: one_to_one
    required: true

uniqueKeys:
  - [id]
  - [project_id, submitter_id]

required:
  - type
  - submitter_id
  - subject

properties:
  $ref: "_definitions.yaml#/ubiquitous_properties"

  # same property names for these:
  # Chemistry (Complete Metabolic Panel, CMP) Lab Results from ENT_CA_DM_Chem_fake.txt
  # Hematology (Complete Blood Count, CBC) Lab Results from ENT_CA_DM_Encounters_CBC_fake.txt: Only results related to blood tests; same variables as Chem
  # Thyroid Panel Lab Results from ENT_CA_DM_Thyroid_fake.txt
  enc_date:
    type: string
    description: date of encounter/lab test
  adm_date:
    type: string
    description: for hospital admissions, date of admission
  disc_date:
    type: string
    description: for hospital admissions, date of discharge
  order_dttm:
    type: string
    description: datetime of lab order
  result_dttm:
    type: string
    description: datetime of result
  order_proc_id:
    type: string
    description: unique ID of procedure corresponding to specific patient/encounter
  proc_code:
    type: string
    description: code of procedure ordered (one procedure corresponds to one lab test/blood draw, i.e. Complete Metabolic Panel)
  proc_desc:
    type: string
    description: description of procedure ordered (one procedure corresponds to one lab test/blood draw, i.e. Complete Metabolic Panel)
  lab_code:
    type: string
    description: code of specific lab value (i.e. Calcium, Potassium, etc.)
  lab_desc:
    type: string
    description: description of specific lab value (i.e. Calcium, Potassium, etc.)
  ord_value:
    type: string
    description: lab result value
  line:
    type: string
    description: which row/line the value appears in the report
  result_in_range_yn:
    type: string
    description: if result is in range (Y or N)
  result_flag:
    type: string
    description: a flag to designate high vs. low with regards to range
  reference_unit:
    type: string
    description: units of measurement for lab tests (i.e. mg/dL)
  HPV:
    type: string
    description: flag for HPV value (custom to 8980 database as we wanted to ID all HPV related patients)
  P16:
    type: string
    description: flag for P16 value
  
  subject:
    description: The submitter_id or id of the subject this lab result belongs to, i.e., a link to a record in the parent node.
    $ref: "_definitions.yaml#/to_one"
